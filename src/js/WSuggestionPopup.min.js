WT_DECLARE_WT_MEMBER(1,JavaScriptConstructor,"WSuggestionPopup",(function(e,t,i,l,s,o,r,a,u){t.wtObj=this;var f=this,c=e.WT,d=null,g=null,h=!1,p=null,y=null,v=o,C=null,m=null,k=!1;this.defaultValue=r;function T(e){return e.classList.contains("Wt-suggest-onedit")||e.classList.contains("Wt-suggest-dropdown")}function b(){return"none"!=t.style.display}function E(n){var l=n.firstChild.firstChild,s=c.getElement(g),o=l.innerHTML,r=l.getAttribute("sug");s.focus();i(s,o,r);e.emit(t,"select",n.id,s.id);S();g=null}var w=null;this.showPopup=function(e){t.style.display="block";f.bringToFront();d=null;m=null;w=e.onkeydown;e.onkeydown=function(e){var t=e||window.event;f.editKeyDown(this,t)}};this.bringToFront=function(){var e=c.maxZIndex();if(e>t.style.zIndex){var n=e+1;t.style.zIndex=n}};function S(){t.style.display="none";if(null!=g&&null!=w){c.getElement(g).onkeydown=w;w=null}}function L(e){if("object"!=typeof c.theme||"bootstrap"!==c.theme.type||5!==c.theme.version)return 16;try{var t=getComputedStyle(e);return parseInt(t.backgroundSize.match(/^([0-9]+)px ([0-9]+)px$/)[1],10)+parseInt(t.backgroundPositionX.match(/^calc[(]100% - ([0-9]+)px[)]$/)[1],10)}catch(e){return 28}}this.editMouseMove=function(e,t){if(T(e)){if(c.widgetCoordinates(e,t).x>e.offsetWidth-L(e)){e.classList&&e.classList.add("Wt-suggest-dropdown-hover");e.style.cursor="default"}else{e.classList&&e.classList.remove("Wt-suggest-dropdown-hover");e.style.cursor=""}}};this.showAt=function(e,t){S();g=e.id;k=!0;f.refilter(t)};this.editClick=function(e,t){if(T(e)){if(c.widgetCoordinates(e,t).x>e.offsetWidth-L(e))if(g==e.id&&b()){S();g=null}else f.showAt(e,"")}};function x(e){var i=t.childNodes;for(n=e?i[0]:i[i.length-1];n;n=e?n.nextSibling:n.previousSibling)if(c.hasTag(n,"LI")&&"none"!=n.style.display)return n;return null}function W(e,t){for(e=t?e.nextSibling:e.previousSibling;e;e=t?e.nextSibling:e.previousSibling)if(c.hasTag(e,"LI")&&"none"!=e.style.display)return e;return null}this.editKeyDown=function(n,i){if(!T(n))return!0;if(g!=n.id)if(n.classList.contains("Wt-suggest-onedit")){g=n.id;k=!1}else{if(!n.classList.contains("Wt-suggest-dropdown")||40!=i.keyCode){g=null;return!0}g=n.id;k=!0}if(b()){var l=d?c.getElement(d):null;if(13==i.keyCode||9==i.keyCode){if(l){E(l);c.cancelEvent(i);setTimeout((function(){n.focus()}),0)}else S();return!1}if(40==i.keyCode||38==i.keyCode||34==i.keyCode||33==i.keyCode){if("KEYDOWN"==i.type.toUpperCase()){h=!0;c.cancelEvent(i,c.CancelDefaultAction)}if("KEYPRESS"==i.type.toUpperCase()&&1==h){c.cancelEvent(i);return!1}var s=l,o=40==i.keyCode||34==i.keyCode;if(s){var r,a=34==i.keyCode||33==i.keyCode?t.clientHeight/l.offsetHeight:1;for(r=0;s&&r<a;++r){var f=W(s,o);if(!f&&u)break;s=f}}else N(s=x(o));if(l){l.className="";d=null}if(s&&c.hasTag(s,"LI")){s.className="active";if("object"==typeof e.theme&&"bootstrap"===e.theme.type&&e.theme.version>=4){l.firstChild.className=l.firstChild.className.replace("active","");s.firstChild.className+=" active"}d=s.id}return!1}}return 13!=i.keyCode&&9!=i.keyCode};this.filtered=function(e,t){p=e;v=t;f.refilter(m)};function N(e){var t=e.parentNode;e.offsetTop+e.offsetHeight>t.scrollTop+t.clientHeight?t.scrollTop=e.offsetTop+e.offsetHeight-t.clientHeight:e.offsetTop<t.scrollTop&&(t.scrollTop=e.offsetTop)}this.refilter=function(n){if(g){var i=d?c.getElement(d):null,r=c.getElement(g),h=l(r),C=t.childNodes,T=a&&null!=n?n:h(null);m=a?n:r.value;if(s>0||o){if(T.length<s&&!k){S();return}var E=v?T:T.substring(0,Math.max(null!==p?p.length:0,s));if(E!=p&&E!=y){y=E;e.emit(t,"filter",E)}}var w,L,x=null,W=null,M=k&&0==T.length;for(w=0,L=C.length;w<L;++w){var H=C[w];if(c.hasTag(H,"LI")){var I=H.firstChild;null==H.orig&&(H.orig=I.firstChild.innerHTML);var A=h(H.orig),R=M||A.match;A.suggestion!=I.firstChild.innerHTML&&(I.firstChild.innerHTML=A.suggestion);if(R){""!=H.style.display&&(H.style.display="");null==x&&(x=H);w==this.defaultValue&&(W=H)}else"none"!=H.style.display&&(H.style.display="none");""!=H.className&&(H.className="")}}if(null==x)S();else{if(!b()){!function(e){t.style.display="block";c.positionAtWidget(t.id,e.id,c.Vertical)}(r);f.showPopup(r);i=null}if((u||W)&&(!i||"none"==i.style.display)){(i=W||x).parentNode.scrollTop=0;d=i.id}if(i){i.className="active";"object"==typeof c.theme&&"bootstrap"===c.theme.type&&c.theme.version>=4&&(i.firstChild.className+=" active");N(i)}}}};this.editKeyUp=function(e,t){if(null!=g&&T(e)&&(b()||13!=t.keyCode&&9!=t.keyCode))if(27==t.keyCode||37==t.keyCode||39==t.keyCode)S();else if(40==t.keyCode||38==t.keyCode||34==t.keyCode||33==t.keyCode);else if(e.value!=m){g=e.id;f.refilter(e.value)}else{var n=d?c.getElement(d):null;n&&N(n)}};t.onclick=function(e){var t=e||window.event,n=c.target(t);if(!c.hasTag(n,"UL")){for(;n&&!c.hasTag(n,"LI");)n=n.parentNode;n&&E(n)}};t.onscroll=function(){if(C){clearTimeout(C);var e=c.getElement(g);e&&e.focus()}};this.delayHide=function(e,n){C=setTimeout((function(){C=null;!t||null!=e&&g!=e.id||S()}),300)}}));WT_DECLARE_WT_MEMBER(2,JavaScriptConstructor,"WSuggestionPopupStdMatcher",(function(e,t,n,i,l,s,o){function r(e){for(var t=e.value,l=e.selectionStart?e.selectionStart:t.length,s=n?t.lastIndexOf(n,l-1)+1:0;s<l&&-1!=i.indexOf(t.charAt(s));)++s;return{start:s,end:l}}this.match=function(n){var i,o=r(n),a=n.value.substring(o.start,o.end);if(0==s.length)if(0!=l.length){i="(^|(?:[";for(var u=0;u<l.length;++u){for(var f=l.charCodeAt(u).toString(16);f.length<4;)f="0"+f;i+="\\u"+f}i+="]))"}else i="(^)";else i="("+s+")";i+="("+a.replace(new RegExp("([\\^\\\\\\][\\-.$*+?()|{}])","g"),"\\$1")+")";i=new RegExp(i,"gi");return function(n){if(!n)return a;var l=!1;if(a.length){var s=n.replace(i,"$1"+e+"$2"+t);if(s!=n){l=!0;n=s}}return{match:l,suggestion:n}}};this.replace=function(e,t,n){var i=r(e),l=e.value.substring(0,i.start)+n+o;i.end<e.value.length&&(l+=e.value.substring(i.end,e.value.length));e.value=l;if(e.selectionStart){e.selectionStart=i.start+n.length+o.length;e.selectionEnd=e.selectionStart}}}));