WT_DECLARE_WT_MEMBER(1,"WSuggestionPopup",function(q,d,A,B,r){function m(a){return $(a).hasClass("Wt-suggest-onedit")||$(a).hasClass("Wt-suggest-dropdown")}function t(){return d.style.display!="none"}function l(){d.style.display="none"}function C(a){c.positionAtWidget(d.id,a.id,c.Vertical)}function D(a){a=a||window.event;a=a.target||a.srcElement;if(a.className!="content"){for(;a&&!c.hasTag(a,"DIV");)a=a.parentNode;a&&u(a)}}function u(a){var b=a.firstChild,h=c.getElement(f),e=b.innerHTML;b=b.getAttribute("sug");
h.focus();q.emit(d,"select",a.id,h.id);A(h,e,b);l();f=null}function E(a,b){for(a=b?a.nextSibling:a.previousSibling;a;a=b?a.nextSibling:a.previousSibling)if(c.hasTag(a,"DIV"))if(a.style.display!="none")return a;return null}function v(a){var b=a.parentNode;if(a.offsetTop+a.offsetHeight>b.scrollTop+b.clientHeight)b.scrollTop=a.offsetTop+a.offsetHeight-b.clientHeight;else if(a.offsetTop<b.scrollTop)b.scrollTop=a.offsetTop}$(".Wt-domRoot").add(d);jQuery.data(d,"obj",this);var n=this,c=q.WT,k=null,f=null,
w=false,x=null,y=null,o=null,s=null;this.showPopup=function(){d.style.display="";s=k=null};this.editMouseMove=function(a,b){if(m(a))a.style.cursor=c.widgetCoordinates(a,b).x>a.offsetWidth-16?"default":""};this.editClick=function(a,b){if(m(a))if(c.widgetCoordinates(a,b).x>a.offsetWidth-16)if(f!=a.id){l();f=a.id;n.refilter()}else{f=null;l()}};this.editKeyDown=function(a,b){if(!m(a))return true;if(f!=a.id)if($(a).hasClass("Wt-suggest-onedit"))f=a.id;else if($(a).hasClass("Wt-suggest-dropdown")&&b.keyCode==
40)f=a.id;else{f=null;return true}var h=k?c.getElement(k):null;if(t()&&h)if(b.keyCode==13||b.keyCode==9){u(h);c.cancelEvent(b);setTimeout(function(){a.focus()},0);return false}else if(b.keyCode==40||b.keyCode==38||b.keyCode==34||b.keyCode==33){if(b.type.toUpperCase()=="KEYDOWN"){w=true;c.cancelEvent(b,c.CancelDefaultAction)}if(b.type.toUpperCase()=="KEYPRESS"&&w==true){c.cancelEvent(b);return false}var e=h,p=b.keyCode==40||b.keyCode==34;b=b.keyCode==34||b.keyCode==33?d.clientHeight/h.offsetHeight:
1;var j;for(j=0;e&&j<b;++j){var g=E(e,p);if(!g)break;e=g}if(e&&c.hasTag(e,"DIV")){h.className="";e.className="sel";k=e.id}return false}return b.keyCode!=13&&b.keyCode!=9};this.filtered=function(a){x=a;n.refilter()};this.refilter=function(){var a=k?c.getElement(k):null,b=c.getElement(f),h=B(b),e=!$(b).hasClass("Wt-suggest-dropdown"),p=d.lastChild.childNodes,j=h(null);s=b.value;if(r)if(e&&j.length<r){l();return}else{var g=j.substring(0,r);if(g!=x){if(g!=y){y=g;q.emit(d,"filter",g)}if(e){l();return}}}g=
null;e=!e&&j.length==0;for(j=0;j<p.length;j++){var i=p[j];if(c.hasTag(i,"DIV")){if(i.orig==null)i.orig=i.firstChild.innerHTML;else i.firstChild.innerHTML=i.orig;var z=h(i.firstChild.innerHTML),F=e||z.match;i.firstChild.innerHTML=z.suggestion;if(F){i.style.display="";if(g==null)g=i}else i.style.display="none";i.className=""}}if(g==null)l();else{if(!t()){C(b);n.showPopup();a=null}if(!a||a.style.display=="none"){k=g.id;a=g;a.parentNode.scrollTop=0}a.className="sel";v(a)}};this.editKeyUp=function(a,b){if(f!=
null)if(m(a))if(!((b.keyCode==13||b.keyCode==9)&&d.style.display=="none"))if(b.keyCode==27||b.keyCode==37||b.keyCode==39){d.style.display="none";if(b.keyCode==27){f=null;$(a).hasClass("Wt-suggest-dropdown")?l():a.blur()}}else if(a.value!=s)n.refilter();else(a=k?c.getElement(k):null)&&v(a)};d.lastChild.onclick=D;d.lastChild.onscroll=function(){if(o){clearTimeout(o);var a=c.getElement(f);a&&a.focus()}};this.delayHide=function(a){o=setTimeout(function(){o=null;if(d&&(a==null||f==a.id))l()},300)}});
