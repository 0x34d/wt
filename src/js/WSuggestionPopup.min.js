WT_DECLARE_WT_MEMBER(1,JavaScriptConstructor,"WSuggestionPopup",function(u,e,y,D,q,z){function r(a){return $(a).hasClass("Wt-suggest-onedit")||$(a).hasClass("Wt-suggest-dropdown")}function c(){return e.style.display!="none"}function g(a){e.style.display="block";d.positionAtWidget(e.id,a.id,d.Vertical)}function i(a){a=d.target(a||window.event);if(!d.hasTag(a,"UL")){for(;a&&!d.hasTag(a,"LI");)a=a.parentNode;a&&n(a)}}function n(a){var b=a.firstChild.firstChild,l=d.getElement(f),m=b.innerHTML;b=b.getAttribute("sug");
l.focus();y(l,m,b);u.emit(e,"select",a.id,l.id);h();f=null}function h(){e.style.display="none";if(f!=null&&A!=null){d.getElement(f).onkeydown=A;A=null}}function B(a,b){for(a=b?a.nextSibling:a.previousSibling;a;a=b?a.nextSibling:a.previousSibling)if(d.hasTag(a,"LI"))if(a.style.display!="none")return a;return null}function v(a){var b=a.parentNode;if(a.offsetTop+a.offsetHeight>b.scrollTop+b.clientHeight)b.scrollTop=a.offsetTop+a.offsetHeight-b.clientHeight;else if(a.offsetTop<b.scrollTop)b.scrollTop=
a.offsetTop}$(".Wt-domRoot").add(e);jQuery.data(e,"obj",this);var s=this,d=u.WT,o=null,f=null,H=false,I=null,J=null,C=null,E=null,t=false;this.defaultValue=z;var A=null;this.showPopup=function(a){e.style.display="block";E=o=null;A=a.onkeydown;a.onkeydown=function(b){s.editKeyDown(this,b||window.event)}};this.editMouseMove=function(a,b){if(r(a))a.style.cursor=d.widgetCoordinates(a,b).x>a.offsetWidth-16?"default":""};this.showAt=function(a){h();f=a.id;t=true;s.refilter()};this.editClick=function(a,
b){if(r(a))if(d.widgetCoordinates(a,b).x>a.offsetWidth-16)if(f!=a.id||!c())s.showAt(a);else{h();f=null}};this.editKeyDown=function(a,b){if(!r(a))return true;if(f!=a.id)if($(a).hasClass("Wt-suggest-onedit")){f=a.id;t=false}else if($(a).hasClass("Wt-suggest-dropdown")&&b.keyCode==40){f=a.id;t=true}else{f=null;return true}var l=o?d.getElement(o):null;if(c()&&l)if(b.keyCode==13||b.keyCode==9){n(l);d.cancelEvent(b);setTimeout(function(){a.focus()},0);return false}else if(b.keyCode==40||b.keyCode==38||
b.keyCode==34||b.keyCode==33){if(b.type.toUpperCase()=="KEYDOWN"){H=true;d.cancelEvent(b,d.CancelDefaultAction)}if(b.type.toUpperCase()=="KEYPRESS"&&H==true){d.cancelEvent(b);return false}var m=l,p=b.keyCode==40||b.keyCode==34;b=b.keyCode==34||b.keyCode==33?e.clientHeight/l.offsetHeight:1;var j;for(j=0;m&&j<b;++j){var w=B(m,p);if(!w)break;m=w}if(m&&d.hasTag(m,"LI")){l.className="";m.className="active";o=m.id}return false}return b.keyCode!=13&&b.keyCode!=9};this.filtered=function(a){I=a;s.refilter()};
this.refilter=function(){var a=o?d.getElement(o):null,b=d.getElement(f),l=D(b),m=e.childNodes,p=l(null);E=b.value;if(q!=0)if(p.length<q&&!t){h();return}else{var j=q==-1?p:p.substring(0,q);if(j!=I){if(j!=J){J=j;u.emit(e,"filter",j)}if(!t){h();return}}}var w=j=null;p=t&&p.length==0;var x,K;x=0;for(K=m.length;x<K;++x){var k=m[x];if(d.hasTag(k,"LI")){var F=k.firstChild;if(k.orig==null)k.orig=F.firstChild.innerHTML;var G=l(k.orig),L=p||G.match;if(G.suggestion!=F.firstChild.innerHTML)F.firstChild.innerHTML=
G.suggestion;if(L){if(k.style.display!="")k.style.display="";if(j==null)j=k;if(x==this.defaultValue)w=k}else if(k.style.display!="none")k.style.display="none";if(k.className!="")k.className=""}}if(j==null)h();else{if(!c()){g(b);s.showPopup(b);a=null}if(!a||a.style.display=="none"){a=w||j;a.parentNode.scrollTop=0;o=a.id}a.className="active";v(a)}};this.editKeyUp=function(a,b){if(f!=null)if(r(a))if(!(!c()&&(b.keyCode==13||b.keyCode==9)))if(b.keyCode==27||b.keyCode==37||b.keyCode==39)h();else if(a.value!=
E)s.refilter();else(a=o?d.getElement(o):null)&&v(a)};e.onclick=i;e.onscroll=function(){if(C){clearTimeout(C);var a=d.getElement(f);a&&a.focus()}};this.delayHide=function(a){C=setTimeout(function(){C=null;if(e&&(a==null||f==a.id))h()},300)}});
WT_DECLARE_WT_MEMBER(2,JavaScriptConstructor,"WSuggestionPopupStdMatcher",function(u,e,y,D,q,z){function r(c){var g=c.value;c=c.selectionStart?c.selectionStart:g.length;for(var i=y?g.lastIndexOf(y,c-1)+1:0;i<c&&D.indexOf(g.charAt(i))!=-1;)++i;return{start:i,end:c}}this.match=function(c){var g=r(c),i=c.value.substring(g.start,g.end),n;n=q.length!=0?"(^|(?:["+q+"]))":"(^)";n+="("+i.replace(new RegExp("([\\^\\\\\\][\\-.$*+?()|{}])","g"),"\\$1")+")";n=new RegExp(n,"gi");return function(h){if(!h)return i;
var B=false;if(i.length){var v=h.replace(n,"$1"+u+"$2"+e);if(v!=h){B=true;h=v}}return{match:B,suggestion:h}}};this.replace=function(c,g,i){g=r(c);var n=c.value.substring(0,g.start)+i+z;if(g.end<c.value.length)n+=c.value.substring(g.end,c.value.length);c.value=n;if(c.selectionStart){c.selectionStart=g.start+i.length+z.length;c.selectionEnd=c.selectionStart}}});
