WT_DECLARE_WT_MEMBER(1,JavaScriptConstructor,"WGLWidget",(function(t,e){e.wtObj=this;var i=this,n=t.WT,s=n.glMatrix.vec3,a=(n.glMatrix.mat3,n.glMatrix.mat4);this.ctx=null;this.initializeGL=function(){};this.paintGL=function(){};this.resizeGL=function(){};this.updates=new Array;this.initialized=!1;this.preloadingTextures=0;this.preloadingBuffers=0;this.jsValues={};this.discoverContext=function(t,i){if(e.getContext){try{this.ctx=e.getContext("webgl",{antialias:i})}catch(t){}if(null===this.ctx)try{this.ctx=e.getContext("experimental-webgl",{antialias:i})}catch(t){}if(null===this.ctx){var n=e.firstChild;e.parentNode.insertBefore(n,e);e.style.display="none";t()}}return this.ctx};if(e.addEventListener){e.addEventListener("webglcontextlost",(function(t){t.preventDefault();i.initialized=!1}),!1);e.addEventListener("webglcontextrestored",(function(i){t.emit(e,"contextRestored")}),!1)}var o=null;this.setMouseHandler=function(t){(o=t).setTarget&&o.setTarget(this)};this.LookAtMouseHandler=function(t,o,u,l,r){var h=t,c=o,f=u,d=l,g=r,p=null,x=null,v=null,m=null,y=this;this.mouseDown=function(t,i){n.capture(null);n.capture(e);m=n.pageCoordinates(i)};this.mouseUp=function(t,e){null!==m&&(m=null)};this.mouseDrag=function(t,e){if(null!==m){var i=n.pageCoordinates(e);1===n.buttons&&w(i)}};this.mouseWheel=function(t,e){n.cancelEvent(e);M(n.wheelDelta(e))};function M(t){var e=Math.pow(1.2,t);a.translate(h,c);a.scale(h,[e,e,e]);s.negate(c);a.translate(h,c);s.negate(c);i.paintGL()}function w(t){var e=h[5]/s.length([h[1],h[5],h[9]]),n=h[6]/s.length([h[2],h[6],h[10]]),o=Math.atan2(n,e),u=t.x-m.x,l=t.y-m.y,r=s.create();r[0]=h[0];r[1]=h[4];r[2]=h[8];var p=a.create();a.identity(p);a.translate(p,c);var x=l*d;if(Math.abs(o+x)>=Math.PI/2){x=(o>0?1:-1)*Math.PI/2-o}a.rotate(p,x,r);a.rotate(p,u*g,f);s.negate(c);a.translate(p,c);s.negate(c);a.multiply(h,p,h);i.paintGL();m=t}this.touchStart=function(t,i){x=1===i.touches.length;v=2===i.touches.length;if(x){n.capture(null);n.capture(e);m=n.pageCoordinates(i.touches[0])}else{if(!v)return;var s=n.pageCoordinates(i.touches[0]),a=n.pageCoordinates(i.touches[1]);p=Math.sqrt((s.x-a.x)*(s.x-a.x)+(s.y-a.y)*(s.y-a.y))}i.preventDefault()};this.touchEnd=function(t,e){var i=0===e.touches.length;x=1===e.touches.length;v=2===e.touches.length;i&&y.mouseUp(null,null);(x||v)&&y.touchStart(t,e)};this.touchMoved=function(t,e){if(x||v){e.preventDefault();if(x){if(null===m)return;w(n.pageCoordinates(e))}if(v){var i=n.pageCoordinates(e.touches[0]),s=n.pageCoordinates(e.touches[1]),a=Math.sqrt((i.x-s.x)*(i.x-s.x)+(i.y-s.y)*(i.y-s.y)),o=a/p;if(Math.abs(o-1)<.05)return;p=a;M(o=o>1?1:-1)}}}};this.WalkMouseHandler=function(t,o,u){var l=t,r=o,h=u,c=null;this.mouseDown=function(t,i){n.capture(null);n.capture(e);c=n.pageCoordinates(i)};this.mouseUp=function(t,e){null!==c&&(c=null)};this.mouseDrag=function(t,e){if(null!==c){f(n.pageCoordinates(e))}};function f(t){var e=t.x-c.x,o=t.y-c.y,u=a.create();a.identity(u);a.rotateY(u,e*h);var f=s.create();f[0]=0;f[1]=0;f[2]=-r*o;a.translate(u,f);a.multiply(u,l,l);i.paintGL();c=n.pageCoordinates(event)}};this.mouseDrag=function(t,e){(this.initialized||!this.ctx)&&o&&o.mouseDrag&&o.mouseDrag(t,e)};this.mouseMove=function(t,e){(this.initialized||!this.ctx)&&o&&o.mouseMove&&o.mouseMove(t,e)};this.mouseDown=function(t,e){(this.initialized||!this.ctx)&&o&&o.mouseDown&&o.mouseDown(t,e)};this.mouseUp=function(t,e){(this.initialized||!this.ctx)&&o&&o.mouseUp&&o.mouseUp(t,e)};this.mouseWheel=function(t,e){(this.initialized||!this.ctx)&&o&&o.mouseWheel&&o.mouseWheel(t,e)};this.touchStart=function(t,e){(this.initialized||!this.ctx)&&o&&o.touchStart&&o.touchStart(t,e)};this.touchEnd=function(t,e){(this.initialized||!this.ctx)&&o&&o.touchEnd&&o.touchEnd(t,e)};this.touchMoved=function(t,e){(this.initialized||!this.ctx)&&o&&o.touchMoved&&o.touchMoved(t,e)};this.handlePreload=function(){if(0===this.preloadingTextures&&0===this.preloadingBuffers)if(this.initialized){var t;for(t in this.updates)this.updates[t]();this.updates=new Array;this.resizeGL();this.paintGL()}else{this.initializeGL();this.resizeGL();this.paintGL()}};e.wtEncodeValue=function(){var t=e.wtObj,i="";for(var n in t.jsValues)if(t.jsValues.hasOwnProperty(n)){i+=n+":";for(var s=0;s<t.jsValues[n].length;s++){i+=t.jsValues[n][s];s!==t.jsValues[n].length-1?i+=",":i+=";"}}return i};var u=null,l=new Image;l.busy=!1;l.onload=function(){e.src=l.src;null!=u?l.src=u:l.busy=!1;u=null};l.onerror=l.onload;this.loadImage=function(t){if(l.busy)u=t;else{l.src=t;l.busy=!0}}}));